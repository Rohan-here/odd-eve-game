<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odd-Even Game</title>
    <link rel="stylesheet" href="Tailwindstyle.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Graduate&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="allStyles.css">
</head>



<body class="bg-pink-700">
    <nav>
        <div class="logo">
            <h4 class="font-bold">BICE<span>.com</span></h4>
        </div>
        <ul class=" nav-links">
            <li>
                <form action="/home" method="GET"><button>Home</button></form>
            </li>
            <li><A href="/dev">Developers</A></li>
            <% if(!currentUser) { %>
                <li><A href="/login">Login</A></li>
                <% } else {%>
                    <li><a href="/playerActive">
                            <%= currentUser.username %>
                        </a></li>
                    <% } %>


        </ul>
    </nav>
    <h1 class="h-20 text-3xl flex justify-center items-center bg-gray-700 text-purple-200 font-bold md:text-5xl "
        id="ButtonBox">
        <span class="" id="bat-bowl">
        </span>
    </h1>
    <div class=" flex justify-around pt-10 pb-5">
        <button id="b1" class="bg-blue-500 w-1/6 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ">1</button>
        <button id="b2" class="bg-blue-500 w-1/6 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">2</button>
        <button id="b3" class="bg-blue-500 w-1/6 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">3</button>
        <button id="b4" class="bg-blue-500 w-1/6 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">4</button>
        <button id="b5" class="bg-blue-500 w-1/6 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">6</button>
    </div>
    <div class=" flex flex-row justify-around">
        <container class="h-96 bg-white w-5/12 border-black border-4 rounded-lg">
            <p class="text-4xl h-1/4 w-full font-bold flex justify-center text-gray-200 items-center bg-green-600">
                Player </p>
            <p class="flex justify-center items-center w-full h-1/4 py-20"><span class=" text-8xl font-bold " id="score"
                    style="font-family: Graduate;"> 0 </span>
            <p class="flex justify-center items-center w-full h-1/4 text-3xl" style="font-family: Graduate;">Score </p>
            </p>

        </container>
        <container class="h-96 bg-white w-5/12 border-black border-4 rounded-lg">
            <p class="text-4xl flex justify-center font-bold items-center h-1/4 w-full text-gray-200 bg-red-600">
                Computer</p>
            <p class="flex justify-center items-center w-full h-1/4 py-20"> <span class="text-8xl font-bold" id="target"
                    style="font-family: Graduate;"> 0 </span>
            <p class="flex justify-center items-center w-full h-1/4 text-3xl" style="font-family: Graduate;">Target </p>
            </p>
        </container>
    </div>

    <div class="flex h-20 justify-center items-center w-full" id="returnScoreButtons">
        <span id="chances" class=" text-4xl font-bold text-yellow-300"></span>

    </div>

    <script>
        const batOrBowl = document.getElementById("bat-bowl");
        const scoreSpan = document.getElementById("score");
        const targetSpan = document.getElementById("target");
        const b1 = document.getElementById("b1");
        const b2 = document.getElementById("b2");
        const b3 = document.getElementById("b3");
        const b4 = document.getElementById("b4");
        const b5 = document.getElementById("b5");
        const finalShow = document.getElementById("chances");
        const buttonBox = document.getElementById("ButtonBox");
        let score = 0;
        let target = 0;
        let chance = 15;
        let doneBatting = false;
        let doneBalling = false;


        let gameState = Math.floor(Math.random() * 2) + 1;
        gameState--;
        console.log(gameState);
        if (gameState == 0) {
            batOrBowl.innerHTML = "You are Balling";
        }
        else {
            batOrBowl.innerHTML = "You are Batting";
        }

        function computerChoice() {
            return Math.floor(Math.random() * 5) + 1;
        }


        function gameover() {
            if (doneBatting && doneBalling) {
                var Replay = document.createElement("button");
                var goHome = document.createElement("button");
                var ReplayForm = document.createElement("form");
                var goHomeForm = document.createElement("form");
                var returnScore = document.createElement("input");
                var returnTarget = document.createElement("input");
                Replay.innerHTML = "Play Again"
                goHome.innerHTML = "Home"
                Replay.classList.add("buttonEnd");
                goHome.classList.add("buttonEnd");
                returnScore.type = "hidden";
                returnTarget.type = "hidden";
                returnScore.name = "returnScore";
                returnTarget.name = "returnTarget";
                returnScore.value = score.toString();
                returnTarget.value = target.toString();

                ReplayForm.action = "/saveScoreAndReturn";
                ReplayForm.method = "post";
                ReplayForm.appendChild(returnScore);
                ReplayForm.appendChild(returnTarget);
                ReplayForm.appendChild(Replay);
                goHomeForm.action = "/saveScoreAndHome";
                goHomeForm.method = "post";
                goHomeForm.appendChild(returnScore);
                goHomeForm.appendChild(returnTarget);
                goHomeForm.appendChild(goHome);
                if (score < target) {
                    finalShow.innerHTML = `You Lost by ${target - score} runs`;
                    batOrBowl.remove();
                    buttonBox.appendChild(ReplayForm);
                    buttonBox.appendChild(goHomeForm);
                }
                else {
                    finalShow.innerHTML = `You Won by ${score - target} runs`;
                    batOrBowl.remove();
                    buttonBox.appendChild(ReplayForm);
                    buttonBox.appendChild(goHomeForm);
                }
                console.log("GAME OVER ");
            }

        }


        function userBat(input) {
            chance--;
            score += input;

            let computerChose = computerChoice();
            if (computerChose == 5) { computerChose++ };
            console.log("Computer Chose " + computerChose);

            finalShow.innerHTML = `Batting chances left ${chance}`;
            if (chance == 0 || (computerChose == input) || (doneBalling && score >= target)) {
                if (computerChose == input) {
                    score -= input;
                    batOrBowl.innerHTML = `Opponent Bowled You at score ${score}`;
                }

                if (!doneBalling)
                    finalShow.innerHTML = `Your chance to Bowl`;
                chance = 15;
                gameState = 0;
                doneBatting = true;
                gameover();
                return;
            }
            else {
                scoreSpan.innerHTML = score;
            }

        }


        function userBowl(input) {
            chance--;


            let computerChose = computerChoice();
            if (computerChose == 5) { computerChose++ };
            finalShow.innerHTML = `Balling chances left ${chance}`;
            target += computerChose;
            console.log("Bowling chances left " + chance);
            if (chance == 0 || (computerChose == input) || (doneBatting && target > score)) {
                if (computerChose == input) {
                    target -= input;
                    batOrBowl.innerHTML = `You Bowled Opponent at score ${target}`;
                }

                if (!doneBatting)
                    finalShow.innerHTML = `Your chance to Bat`;
                chance = 15;
                gameState = 1;
                doneBalling = true;
                gameover();
                return;
            }
            else {
                targetSpan.innerHTML = target;
            }
        }

        function gamePlay(userIn) {
            console.log("User Chose " + userIn);
            if (!doneBatting || !doneBalling) {
                if (gameState == 0) {
                    batOrBowl.innerHTML = "You are Balling";
                    userBowl(userIn);
                }
                else {
                    batOrBowl.innerHTML = "You are Batting";
                    userBat(userIn);
                }
            }


        }

        b1.addEventListener('click', function () {
            gamePlay(parseInt(this.innerHTML));
        })


        b2.addEventListener('click', function () {
            gamePlay(parseInt(this.innerHTML));
        })

        b3.addEventListener('click', function () {
            gamePlay(parseInt(this.innerHTML));
        })

        b4.addEventListener('click', function () {
            gamePlay(parseInt(this.innerHTML));
        })

        b5.addEventListener('click', function () {
            gamePlay(parseInt(this.innerHTML));
        })




    </script>
</body>

</html>